---
id: solution-appendices-operator
sidebar_position: 3
title: Extra Operator Tasks
---

## Adding Object Stores

:::note
This presumes the following:
- You already have the FNCM Operator deployed and running per this [link](/3-Create/Deploy/operator.mdx)
- You already have Postgres deployed and running per this [link](/3-Create/Deploy/postgres.mdx)
- You have already created the required databases for the object stores per this [link](/5-Appendices/postgres-extratasks.mdx) 
:::

### Update the CR

:::note[Super Important!]
Important to note: 
```
    dc_common_os_datasource_name: "FNOS1DS"
    dc_common_os_xa_datasource_name: "FNOS1DSXA"
```

The above need to be unique to each object store. For our example we will be incrementing them.
:::

#### Adding the entries for `dc_os_datasources`

In your CR file you will need to add the following entries. First find your `dc_os_datasources`
```tsx
// highlight-next-line
    dc_os_datasources:
      ## Provide the database type from your infrastructure.  The possible values are "db2" or "db2HADR" or "oracle" or "sqlserver" or "postgresql".  This should be the same as the
      ## GCD configuration above.
      - dc_database_type: "postgresql"
        ## Provide the object store label for the object store.  The default value is "os" or not defined.
        ## This label must match the OS secret you define in ibm-fncm-secret.
        ## For example, if you define dc_os_label: "abc", then your OS secret must be defined as:
        ## --from-literal=abcDBUsername="<your os db username>" --from-literal=abcDBPassword="<your os db password>"
        ## If you don't define dc_os_label, then your secret will be defined as:
        ## --from-literal=osDBUsername="<your os db username>" --from-literal=osDBPassword="<your os db password>".
        ## If you have multiple object stores, then you need to define multiple datasource sections starting
        ## at "dc_database_type" element.
        ## If all the object store databases share the same username and password, then dc_os_label value should be the same
        ## in all the datasource sections.
        dc_os_label: "os"
        ## The OS1 non-XA datasource name.  The default value is "FNOS1DS".
        dc_common_os_datasource_name: "FNOS1DS"
        ## The OS1 XA datasource name.  The default value is "FNOS1DSXA".
        dc_common_os_xa_datasource_name: "FNOS1DSXA"
        ## Provide the database server name or IP address of the database server.  This should be the same as the
        ## GCD configuration above.
        database_servername: "10.233.50.151"
        ## Provide the name of the database for the object store 1 for CPE.  For example: "OS1DB"
        database_name: "osdb"
        ## Provide the database server port.  For Db2, the default is "50000".  For Oracle, the default is "1521"
        database_port: "5432"
        ## The name of the secret that contains the DB2/Oracle/PostgreSQL/SQLServer SSL certificate.
        database_ssl_secret_name: "<Required>"
        ## If the database type is Oracle, provide the Oracle DB connection string.  For example, "jdbc:oracle:thin:@//<oracle_server>:1521/orcl"
        dc_oracle_os_jdbc_url: "<Required>"
        ## Provide the validation timeout.  If not preference, keep the default value.
        dc_hadr_validation_timeout: 15
        ######################################################################################
        ## If the database type is "Db2HADR", then complete the rest of the parameters below.
        ## Otherwise, remove or comment out the rest of the parameters below.
        ######################################################################################
        dc_hadr_standby_servername: "<Required>"
        ## Provide the standby database server port.  For Db2, the default is "50000".
        dc_hadr_standby_port: "<Required>"
        ## Provide the retry internal.  If not preference, keep the default value.
        dc_hadr_retry_interval_for_client_reroute: 15
        ## Provide the max # of retries.  If not preference, keep the default value.
        dc_hadr_max_retries_for_client_reroute: 3
```
There's a lot of stuff going on there with the comments, but it boils down to this:
```
    dc_os_datasources:
      - dc_database_type: "postgresql"
        dc_os_label: "os"
        dc_common_os_datasource_name: "FNOS1DS"
        dc_common_os_xa_datasource_name: "FNOS1DSXA"
        database_servername: "172.21.23.244"
        database_name: "osdb"
        database_port: "5432"
        database_ssl_secret_name: "<Required>"
        dc_oracle_os_jdbc_url: "<Required>"
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: "<Required>"
        dc_hadr_standby_port: "<Required>"
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3
```
Above is the entry for the intial object store we created when first deploying the operator. The full breakdown of the fields are in the comments above.

What we care about for this task is the following:
- `database_servername` - this should be the same as the other entries. It will be the internal ip address of the postgres service. It can also be the service name as well.
- `database_name` - this will be the name of one of the new databases we created as part of [the postgres extra tasks](/5-Appendices/postgres-extratasks.mdx) 

So adding the new object store databases we created would look like this. As noted, we are incrementing both `dc_common_os_datasource_name` and `dc_common_os_xa_datasource_name` to keep them unique for each object store.
```tsx
      - dc_database_type: "postgresql"
        dc_os_label: "os"
        dc_common_os_datasource_name: "FNOS1DS2"
        dc_common_os_xa_datasource_name: "FNOS1DSXA2"
        database_servername: "172.21.23.244"
        database_name: "os2db"
        database_port: "5432"
        database_ssl_secret_name: "<Required>"
        dc_oracle_os_jdbc_url: "<Required>"
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: "<Required>"
        dc_hadr_standby_port: "<Required>"
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3
      - dc_database_type: "postgresql"
        dc_os_label: "os"
        dc_common_os_datasource_name: "FNOS1DS3"
        dc_common_os_xa_datasource_name: "FNOS1DSXA3"
        database_servername: "172.21.23.244"
        database_name: "os3db"
        database_port: "5432"
        database_ssl_secret_name: "<Required>"
        dc_oracle_os_jdbc_url: "<Required>"
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: "<Required>"
        dc_hadr_standby_port: "<Required>"
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3
      - dc_database_type: "postgresql"
        dc_os_label: "os"
        dc_common_os_datasource_name: "FNOS1DS4"
        dc_common_os_xa_datasource_name: "FNOS1DSXA4"
        database_servername: "172.21.23.244"
        database_name: "fposdb"
        database_port: "5432"
        database_ssl_secret_name: "<Required>"
        dc_oracle_os_jdbc_url: "<Required>"
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: "<Required>"
        dc_hadr_standby_port: "<Required>"
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3
      - dc_database_type: "postgresql"
        dc_os_label: "os"
        dc_common_os_datasource_name: "FNOS1DS5"
        dc_common_os_xa_datasource_name: "FNOS1DSXA5"
        database_servername: "172.21.23.244"
        database_name: "rosdb"
        database_port: "5432"
        database_ssl_secret_name: "<Required>"
        dc_oracle_os_jdbc_url: "<Required>"
        dc_hadr_validation_timeout: 15
        dc_hadr_standby_servername: "<Required>"
        dc_hadr_standby_port: "<Required>"
        dc_hadr_retry_interval_for_client_reroute: 15
        dc_hadr_max_retries_for_client_reroute: 3
```

#### Adding the entries for `ic_obj_store_creation`

With that added, we now need to skip down to the object store creation entry `ic_obj_store_creation`
```tsx
    ic_obj_store_creation:
      object_stores:
        - oc_cpe_obj_store_display_name: "OS01" # Required display name of the object store, for example, "OS01"
          oc_cpe_obj_store_symb_name: "OS01" # Required symbolic name of the object store, for example, "OS01"
          oc_cpe_obj_store_conn:
            name: "OS01_dbconnection"
            dc_os_datasource_name: "FNOS1DS" # This value must match with the non-XA datasource name in the "datasource_configuration" above.
            dc_os_xa_datasource_name: "FNOS1DSXA" # This value must match with the XA datasource name in the "datasource_configuration" above.
          oc_cpe_obj_store_admin_user_groups:
            - "cpadmins" # user name and group name for object store admin, for example, "CEAdmin" or "P8Administrators".  This parameter accepts a list of values.
```
Above we see the initial object store we created when we first applied the CR. We need to add more entries under this. Take note that the `dc_os_datasource_name` and the `dc_os_xa_datasource_name` match each entry in `dc_os_datasources`.
```tsx
        - oc_cpe_obj_store_display_name: "OS02"
          oc_cpe_obj_store_symb_name: "OS02"
          oc_cpe_obj_store_conn:
            name: "OS02_dbconnection"
            dc_os_datasource_name: "FNOS1DS2" # This value must match with the non-XA datasource name in the "datasource_configuration" above.
            dc_os_xa_datasource_name: "FNOS1DSXA2" # This value must match with the XA datasource name in the "datasource_configuration" above.
          oc_cpe_obj_store_admin_user_groups:
            - "cpadmins"
            - "cpadmin"
        - oc_cpe_obj_store_display_name: "OS03"
          oc_cpe_obj_store_symb_name: "OS03"
          oc_cpe_obj_store_conn:
            name: "OS03_dbconnection"
            dc_os_datasource_name: "FNOS1DS3" 
            dc_os_xa_datasource_name: "FNOS1DSXA3"
          oc_cpe_obj_store_admin_user_groups:
            - "cpadmins" 
            - "cpadmin"
        - oc_cpe_obj_store_display_name: "FPOS"
          oc_cpe_obj_store_symb_name: "FPOS"
          oc_cpe_obj_store_conn:
            name: "FPOS_dbconnection"
            dc_os_datasource_name: "FNOS1DS4" 
            dc_os_xa_datasource_name: "FNOS1DSXA4" 
          oc_cpe_obj_store_admin_user_groups:
            - "cpadmins" 
            - "cpadmin"
        - oc_cpe_obj_store_display_name: "ROS"
          oc_cpe_obj_store_symb_name: "ROS"
          oc_cpe_obj_store_conn:
            name: "ROS_dbconnection"
            dc_os_datasource_name: "FNOS1DS5"
            dc_os_xa_datasource_name: "FNOS1DSXA5"
          oc_cpe_obj_store_admin_user_groups:
            - "cpadmins" 
            - "cpadmin"
```

#### Adding the entries for `ic_icn_init_info`

Now we need to create the repos in the CR and enable the workflows. Search down in the CR for `ic_icn_init_info`.
:::note[Super Important!]
As of 5.5.11, the `add_repo_ce_wsi_url` changed to an https url. This is important to note on upgrades from 5.5.10 or lower.

Previously it was
```tsx
          add_repo_ce_wsi_url: "http://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9080/wsi/FNCEWS40MTOM/"
```
and now it is
```tsx
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
```
This appendice assumes 5.5.11.
:::

```tsx
    ic_icn_init_info
      icn_repos:
        - add_repo_id: "OS01repo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "OS01"
          add_repo_os_dis_name: "OS01"
          add_repo_workflow_enable: false
          add_repo_work_conn_pnt: "pe_conn_os1:1"
          add_repo_protocol: "FileNetP8WSI"
```
Let's add the new object stores here. We are defining the following unique attributes for each object store:
- `add_repo_id`
- `add_repo_os_sym_name`
- `add_repo_os_dis_name`
- `add_repo_work_conn_pnt`

Also for these object stores we want to enable workflows. It's ok to leave it off for `OS01repo`, but the new ones we are adding require it.

- `add_repo_workflow_enable: true` 

```tsx
    ic_icn_init_info
      icn_repos:
        - add_repo_id: "OS01repo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "OS01"
          add_repo_os_dis_name: "OS01"
          add_repo_workflow_enable: false
          add_repo_work_conn_pnt: "pe_conn_os1:1"
          add_repo_protocol: "FileNetP8WSI"
        - add_repo_id: "OS02repo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "OS02"
          add_repo_os_dis_name: "OS02"
          add_repo_workflow_enable: true
          add_repo_work_conn_pnt: "pe_conn_os2:1"
          add_repo_protocol: "FileNetP8WSI"
        - add_repo_id: "OS03repo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "OS03"
          add_repo_os_dis_name: "OS03"
          add_repo_workflow_enable: true
          add_repo_work_conn_pnt: "pe_conn_os3:1"
          add_repo_protocol: "FileNetP8WSI"
        - add_repo_id: "FPOSrepo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "FPOS"
          add_repo_os_dis_name: "FPOS"
          add_repo_workflow_enable: true
          add_repo_work_conn_pnt: "pe_conn_fpos1:1"
          add_repo_protocol: "FileNetP8WSI"
        - add_repo_id: "ROSrepo"
          add_repo_ce_wsi_url: "https://{{ meta.name }}-cpe-stateless-svc.{{ meta.namespace }}.svc:9443/wsi/FNCEWS40MTOM/"
          add_repo_os_sym_name: "ROS"
          add_repo_os_dis_name: "ROS"
          add_repo_workflow_enable: true
          add_repo_work_conn_pnt: "pe_conn_ros1:1"
          add_repo_protocol: "FileNetP8WSI"
```

#### Apply the CR to the cluster

```tsx
kubectl apply -f ibm_fncm_cr_production_abrv.yaml
```

The initialization of the object stores will take some time, but will ultimately be observable via the ACCE web ui.

![ACCE](https://zenhub.ibm.com/images/58adc1fd5a3922f84995d86b/42ab81b8-568b-4e6d-9113-e26a5cdcf66d)